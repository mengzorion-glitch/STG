# V0.0.0 - å°ˆæ¡ˆç’°å¢ƒå»ºç½® è©³ç´°æ­¥é©Ÿ

## æ­¥é©Ÿ 1ï¼šå»ºç«‹å°ˆæ¡ˆ

```bash
# å»ºç«‹ Vite + TypeScript å°ˆæ¡ˆ
npm create vite@latest stg-game -- --template vanilla-ts
cd stg-game
npm install

# å®‰è£ Phaser
npm install phaser

# å®‰è£éƒ¨ç½²å·¥å…· + Node é¡å‹
npm install -D gh-pages @types/node
```

---

## æ­¥é©Ÿ 2ï¼šæ¸…ç† Vite é è¨­æª”æ¡ˆ

åˆªé™¤ vanilla-ts æ¨¡æ¿çš„é è¨­æª”æ¡ˆï¼š

```bash
# åˆªé™¤é è¨­ç¯„ä¾‹æª”æ¡ˆ
rm src/counter.ts
rm src/style.css        # ç¨å¾Œæœƒå»ºç«‹æ–°çš„
rm public/vite.svg      # å¦‚æœå­˜åœ¨
```

ä¿ç•™çš„æª”æ¡ˆï¼š
- `src/main.ts` - éœ€è¦æ¸…ç©ºä¸¦é‡å¯«
- `src/vite-env.d.ts` - éœ€è¦ä¿®æ”¹åŠ å…¥ `__APP_VERSION__` è²æ˜

---

## æ­¥é©Ÿ 3ï¼šå»ºç«‹å°ˆæ¡ˆç›®éŒ„çµæ§‹

å»ºç«‹ä»¥ä¸‹ç›®éŒ„çµæ§‹ï¼š

```
stg-game/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml        # GitHub Actions éƒ¨ç½²è¨­å®š
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ audio/                # éŸ³æ•ˆæª”æ¡ˆ (æœªä¾†ä½¿ç”¨)
â”‚   â”œâ”€â”€ images/               # åœ–ç‰‡è³‡æº
â”‚   â”œâ”€â”€ sprites/              # è§’è‰²åœ–ç‰‡ (æœªä¾†ä½¿ç”¨)
â”‚   â”œâ”€â”€ effects/              # ç‰¹æ•ˆåœ–ç‰‡ (æœªä¾†ä½¿ç”¨)
â”‚   â”œâ”€â”€ icons/                # PWA åœ–ç¤º
â”‚   â”‚   â”œâ”€â”€ icon_192.png      # å¿…è¦
â”‚   â”‚   â”œâ”€â”€ icon_512.png      # å¿…è¦
â”‚   â”‚   â””â”€â”€ icon_700.png      # é¸ç”¨
â”‚   â””â”€â”€ manifest.json         # PWA manifest
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ scenes/               # Phaser å ´æ™¯
â”‚   â”œâ”€â”€ systems/              # éŠæˆ²ç³»çµ±
â”‚   â”œâ”€â”€ config/               # è¨­å®šæª”
â”‚   â”œâ”€â”€ main.ts               # é€²å…¥é»
â”‚   â””â”€â”€ vite-env.d.ts         # Vite é¡å‹è²æ˜
â”œâ”€â”€ scripts/                  # å·¥å…·è…³æœ¬ (é¸ç”¨)
â”‚   â””â”€â”€ generate-icons.js     # åœ–ç¤ºç”Ÿæˆå™¨
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ generate-sw.js            # SW ç”Ÿæˆè…³æœ¬
```

> **Note**: `sw.js` æ˜¯å»ºç½®æ™‚ç”± `generate-sw.js` è‡ªå‹•ç”Ÿæˆåˆ° `dist/` ç›®éŒ„ï¼Œä¸éœ€è¦æ‰‹å‹•å»ºç«‹ã€‚

---

## æ­¥é©Ÿ 4ï¼špackage.json è¨­å®š

```json
{
  "name": "stg-game",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build && node generate-sw.js",
    "preview": "vite preview",
    "deploy": "npm run build && gh-pages -d dist"
  },
  "devDependencies": {
    "gh-pages": "^6.3.0",
    "typescript": "^5.2.2",
    "vite": "^5.0.0",
    "@types/node": "^20.0.0"
  },
  "dependencies": {
    "phaser": "^3.80.0"
  }
}
```

> **Note**: `@types/node` ç”¨æ–¼ vite.config.ts ä¸­çš„ `fs` æ¨¡çµ„å‹åˆ¥æ”¯æ´ã€‚

---

## æ­¥é©Ÿ 5ï¼štsconfig.json è¨­å®š

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}
```

> **Note**: é€™æ˜¯ Vite vanilla-ts æ¨¡æ¿çš„é è¨­è¨­å®šï¼Œå•Ÿç”¨ strict modeã€‚

---

## æ­¥é©Ÿ 6ï¼švite.config.ts è¨­å®š

```typescript
import { defineConfig } from 'vite';
import { readFileSync } from 'fs';

// è®€å– package.json ç‰ˆæœ¬è™Ÿ
const pkg = JSON.parse(readFileSync('./package.json', 'utf-8'));

export default defineConfig({
  base: '/stg-game/',  // GitHub Pages è·¯å¾‘ï¼ˆæ”¹æˆä½ çš„ repo åç¨±ï¼‰
  define: {
    __APP_VERSION__: JSON.stringify(pkg.version)
  },
  build: {
    assetsInlineLimit: 0
  }
});
```

---

## æ­¥é©Ÿ 7ï¼šsrc/vite-env.d.ts é¡å‹è²æ˜

å»ºç«‹ `src/vite-env.d.ts`ï¼š

```typescript
/// <reference types="vite/client" />

declare const __APP_VERSION__: string;
```

> **Note**: é€™å€‹æª”æ¡ˆè®“ TypeScript èªè­˜ Vite æ³¨å…¥çš„å…¨åŸŸè®Šæ•¸ã€‚

---

## æ­¥é©Ÿ 8ï¼šGitHub Actions éƒ¨ç½²è¨­å®š

å»ºç«‹ `.github/workflows/deploy.yml` (éœ€å…ˆå»ºç«‹ `.github/workflows/` ç›®éŒ„)ï¼š

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

**GitHub è¨­å®šï¼š**
1. é€²å…¥ Repository â†’ Settings â†’ Pages
2. Source é¸æ“‡ "GitHub Actions"

---

## æ­¥é©Ÿ 9ï¼šPWA manifest.json

å»ºç«‹ `public/manifest.json`ï¼š

```json
{
  "name": "STG Game",
  "short_name": "StgGame",
  "description": "A Phaser web game",
  "start_url": "./",
  "display": "standalone",
  "orientation": "landscape",
  "background_color": "#111111",
  "theme_color": "#111111",
  "icons": [
    {
      "src": "icons/icon_192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "icons/icon_512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

---

## æ­¥é©Ÿ 10ï¼šService Worker ç”Ÿæˆè…³æœ¬

å»ºç«‹ `generate-sw.js`ï¼š

```javascript
import { readFileSync, writeFileSync, readdirSync, statSync } from 'fs';
import { join, relative } from 'path';

// è®€å–ç‰ˆæœ¬è™Ÿ
const pkg = JSON.parse(readFileSync('./package.json', 'utf-8'));
const VERSION = pkg.version;

// éè¿´å–å¾—æ‰€æœ‰æª”æ¡ˆ
function getAllFiles(dir, baseDir = dir) {
  let files = [];
  try {
    for (const file of readdirSync(dir)) {
      const filePath = join(dir, file);
      if (statSync(filePath).isDirectory()) {
        files = files.concat(getAllFiles(filePath, baseDir));
      } else {
        // ä½¿ç”¨ path.relative è¨ˆç®—ç›¸å°è·¯å¾‘ï¼Œä¸¦çµ±ä¸€è½‰ç‚º POSIX æ ¼å¼
        const relativePath = relative(baseDir, filePath).replace(/\\/g, '/');
        files.push('./' + relativePath);
      }
    }
  } catch (e) {
    console.warn(`Warning: Could not list files in ${dir}: ${e.message}`);
  }
  return files;
}

// å–å¾— dist è³‡æ–™å¤¾æ‰€æœ‰æª”æ¡ˆ
const distFiles = getAllFiles('./dist');

// ç”Ÿæˆ Service Worker
const swContent = `
const CACHE_NAME = 'stg-game-v${VERSION}';
const ASSETS = ${JSON.stringify(distFiles, null, 2)};

// å®‰è£æ™‚å¿«å–æ‰€æœ‰è³‡æº
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll(ASSETS);
    })
  );
  self.skipWaiting();
});

// å•Ÿç”¨æ™‚æ¸…é™¤èˆŠå¿«å–
self.addEventListener('activate', (event) => {
  event.waitUntil(
    caches.keys().then((cacheNames) => {
      return Promise.all(
        cacheNames
          .filter((name) => name.startsWith('stg-game-') && name !== CACHE_NAME)
          .map((name) => caches.delete(name))
      );
    })
  );
  self.clients.claim();
});

// æ””æˆªè«‹æ±‚ï¼Œå„ªå…ˆä½¿ç”¨å¿«å–
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request).then((response) => {
      return response || fetch(event.request);
    })
  );
});
`;

writeFileSync('./dist/sw.js', swContent.trim());
console.log(`[SW] Generated sw.js with version ${VERSION}`);
```

> **Note**: ä½¿ç”¨ `path.relative` ç¢ºä¿ Windows/Linux è·¯å¾‘ç›¸å®¹æ€§ã€‚

---

## æ­¥é©Ÿ 11ï¼šindex.html å®Œæ•´è¨­å®š

å»ºç«‹ `index.html`ï¼š

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>STG Game</title>
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon_192.png">
</head>
<body>
  <!-- æ©«å‘æç¤º -->
  <div id="rotate-prompt">
    <div class="icon">ğŸ“±</div>
    <div class="text">è«‹å°‡è£ç½®æ—‹è½‰ç‚ºæ©«å‘<br>Please rotate to landscape</div>
  </div>

  <!-- éŠæˆ²å®¹å™¨ -->
  <div id="app"></div>

  <script type="module" src="/src/main.ts"></script>
  <script>
    // å˜—è©¦é–å®šè¢å¹•æ–¹å‘
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock('landscape').catch(() => {});
    }

    // è¨»å†Š Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW registered'))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
```

> **Note**: `theme-color` ä½¿ç”¨ `#000000` (é»‘è‰²) é…åˆéŠæˆ²èƒŒæ™¯ã€‚

---

## æ­¥é©Ÿ 12ï¼šPWA åœ–ç¤º

æº–å‚™åœ–ç¤ºæ”¾å…¥ `public/icons/`ï¼š
- `icon_192.png` (192x192 px) - manifest å¿…è¦
- `icon_512.png` (512x512 px) - manifest å¿…è¦
- `icon_700.png` (700x700 px) - é¸ç”¨ï¼Œé«˜è§£æåº¦è£ç½®

å»ºè­°ä½¿ç”¨æ­£æ–¹å½¢ã€ç°¡æ½”çš„è¨­è¨ˆï¼Œæ”¯æ´ maskable æ ¼å¼ã€‚

### é¸ç”¨ï¼šåœ–ç¤ºç”Ÿæˆè…³æœ¬

å¦‚æœéœ€è¦å¿«é€Ÿç”Ÿæˆæ¸¬è©¦ç”¨åœ–ç¤ºï¼Œå¯å»ºç«‹ `scripts/generate-icons.js`ï¼š

```javascript
/**
 * ç”Ÿæˆ PWA åœ–ç¤ºçš„è…³æœ¬
 * åŸ·è¡Œ: node scripts/generate-icons.js
 * æ³¨æ„: é€™åªæ˜¯ç”Ÿæˆç°¡å–®çš„æ¸¬è©¦ç”¨åœ–ç¤ºï¼Œæ­£å¼ç™¼å¸ƒè«‹ä½¿ç”¨è¨­è¨ˆå¥½çš„åœ–ç¤º
 */
import { writeFileSync, mkdirSync, existsSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const iconsDir = join(__dirname, '../public/icons');

if (!existsSync(iconsDir)) {
    mkdirSync(iconsDir, { recursive: true });
}

// ç”Ÿæˆç°¡å–®çš„ PNG (å®Œæ•´ç¨‹å¼ç¢¼è«‹åƒé–±å°ˆæ¡ˆä¸­çš„å¯¦éš›æª”æ¡ˆ)
// ...
```

> **Note**: é€™æ˜¯é¸ç”¨çš„å·¥å…·è…³æœ¬ï¼Œç”¨æ–¼ç”Ÿæˆæ¸¬è©¦ç”¨åœ–ç¤ºã€‚æ­£å¼ç™¼å¸ƒæ™‚æ‡‰ä½¿ç”¨å°ˆæ¥­è¨­è¨ˆçš„åœ–ç¤ºã€‚

---

## æ­¥é©Ÿ 13ï¼šé©—è­‰éƒ¨ç½²èˆ‡ PWA æ¸¬è©¦

### 13.1 æœ¬åœ° PWA æ¸¬è©¦

> âš ï¸ **é‡è¦**ï¼šPWA åŠŸèƒ½ï¼ˆService Workerã€å®‰è£æç¤ºï¼‰åªæœ‰åœ¨ **build æ¨¡å¼** ä¸‹æ‰æœƒç”Ÿæ•ˆã€‚
> `npm run dev` é–‹ç™¼æ¨¡å¼ä¸‹ä¸æœƒç”Ÿæˆ `sw.js`ï¼Œå› æ­¤ç„¡æ³•æ¸¬è©¦ PWAã€‚

```bash
# 1. å»ºç½®å°ˆæ¡ˆ (æœƒè‡ªå‹•ç”Ÿæˆ sw.js)
npm run build

# 2. å•Ÿå‹•é è¦½ä¼ºæœå™¨
npm run preview

# 3. é–‹å•Ÿç€è¦½å™¨è¨ªå•ï¼š
# http://localhost:4173/stg-game/
```

### 13.2 é©—è­‰ PWA å®‰è£

åœ¨ Chrome ç€è¦½å™¨ä¸­ï¼š
1. é–‹å•Ÿ DevTools â†’ Application â†’ Manifest
   - ç¢ºèª manifest è¼‰å…¥æˆåŠŸ
   - ç¢ºèªåœ–ç¤ºé¡¯ç¤ºæ­£ç¢º
2. é–‹å•Ÿ DevTools â†’ Application â†’ Service Workers
   - ç¢ºèª sw.js å·²è¨»å†Š
3. ç¶²å€åˆ—å³å´æ‡‰å‡ºç¾å®‰è£åœ–ç¤º (âŠ•)
4. é»æ“Šå®‰è£ï¼Œç¢ºèª PWA å¯å®‰è£åˆ°æ¡Œé¢

### 13.3 éƒ¨ç½²åˆ° GitHub Pages

```bash
git add .
git commit -m "v0.0.0 - å°ˆæ¡ˆç’°å¢ƒå»ºç½®"
git push origin main

# ç­‰å¾… GitHub Actions å®Œæˆå¾Œè¨ªå•ï¼š
# https://[username].github.io/[repo-name]/
```

---

## å®Œæˆæª¢æŸ¥æ¸…å–®

- [ ] `npm run dev` å¯æ­£å¸¸å•Ÿå‹•
- [ ] `npm run build` å»ºç½®æˆåŠŸ
- [ ] `dist/sw.js` è‡ªå‹•ç”Ÿæˆ
- [ ] `npm run preview` å¯é è¦½å»ºç½®çµæœ
- [ ] PWA manifest è¼‰å…¥æ­£ç¢º (DevTools é©—è­‰)
- [ ] Service Worker è¨»å†ŠæˆåŠŸ (DevTools é©—è­‰)
- [ ] ç€è¦½å™¨é¡¯ç¤º PWA å®‰è£æç¤º
- [ ] PWA å¯å®‰è£åˆ°æ¡Œé¢/æ‰‹æ©Ÿ
- [ ] GitHub Actions éƒ¨ç½²æˆåŠŸ
- [ ] é›¢ç·šæ¨¡å¼å¯æ­£å¸¸é‹ä½œ

